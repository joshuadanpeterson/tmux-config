# .tmux.conf

# Set prefix to Ctrl + Space
unbind C-b
set -g prefix C-Space
bind C-Space send-prefix

# Set colors
# set-option -sa terminal-overrides ",xterm*:Tc"

# Vi-style pane selection
bind -r k select-pane -U
bind -r j select-pane -D
bind -r h select-pane -L
bind -r l select-pane -R

# Cycle through windows
bind -n M-H previous-window
bind -n M-L next-window

# Switch Sessions
bind-key S choose-session

# Enable vi mode-keys for copy mode
setw -g mode-keys vi

# Improved pane splitting commands
bind | split-window -h
bind - split-window -v
unbind '"'
unbind %

# Start windows and panes at 1, not 0
set -g base-index 1
set -g pane-base-index 1
set-window-option -g pane-base-index 1
set-option -g renumber-windows on

# Set mouse resizing
set-option -g mouse on

# Reload tmux config
unbind r
bind r source-file ~/.config/tmux/.tmux.conf

# Clipboard integration for macOS (requires reattach-to-user-namespace)
bind -T copy-mode-vi v send -X begin-selection
bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "pbcopy"
bind-key -T copy-mode-vi C-v send-keys -X rectangle-toggled
bind P paste-buffer
bind -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel "pbcopy"

# Improved Statusbar Info
# Bind key to display pane numbers for a short duration
bind-key q display-panes

# Launch Ranger
bind-key r split-window -vb 'ranger'

# # Merge statusbars with vim-tpipeline
set -g focus-events on
set -g status-style bg=default
set -g status-left-length 90
set -g status-right-length 90
set -g status-justify centre
set -g default-terminal "xterm-256color"

# Set color consistency
# set -s default-terminal tmux-256color
# set -as terminal-overrides ",*:Tc"

# Custom command to reset status line
bind R set-option -g status-right "Your default status-right config" \; set-option -g status-left "Your default status-left config"

# Load plugins
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @plugin 'tmux-plugins/tmux-pain-control'
set -g @plugin 'tmux-plugins/tmux-logging'
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @plugin 'imomaliev/tmux-keyboard-layout'

# Set Tmux Menu
# bind C run-shell "tmux display-popup -E 'nvim -c \"Telescope custom_tmux_commands_picker\"'"
bind F run-shell '~/.config/tmux/scripts/switch_sessions/tmux_switch_session.sh'

bind-key M display-menu -T "#[align=centre] Tmux Command Menu" \
    "New Window (n)" n "new-window" \
    "New Session (NS)" NS "new-session" \
    "Split Horizontally (H)" H "split-window -h" \
    "Split Vertically (V)" V "split-window -v" \
    "Kill Pane (KP)" KP "confirm-before -p 'kill-pane #P? (y/n)' kill-pane" \
    "Kill Window (KW)" KW "confirm-before -p 'kill-window #W? (y/n)' kill-window" \
    "Kill Server (KS)" KS "confirm-before -p 'kill-server? (y/n)' kill-server" \
    "Detach Client (d)" D "detach-client" \
    "Next Window (W)" W "next-window" \
    "Previous Window (P)" P "previous-window" \
    "Rename Window (r)" r "command-prompt -I '#W' 'rename-window %%'" \
    "Rename Session (s)" s "command-prompt -I '#S' 'rename-session %%'" \
    "List Sessions (LS)" LS "choose-tree -Zs" \
    "List Windows (LW)" LW "choose-tree -Zw" \
    "Select Window (SW)" SW "command-prompt -T window-target -p index 'select-window -t :%%'" \
    "Rotate Window (RO)" RO "rotate-window" \
    "Next Layout (XL)" XL "next-layout" \
    "Show Time (ST)" ST "clock-mode" \
    "Display Pane Numbers (DP)" DP "display-panes" \
    "Select Pane # (SP)" SP "command-prompt -p 'Enter pane #: ' 'select-pane -t :%%'" \
    "Resize Pane Left (RL)" RL "resize-pane -L 5" \
    "Resize Pane Down (RD)" RD "resize-pane -D 5" \
    "Resize Pane Up (RU)" RU "resize-pane -U 5" \
    "Resize Pane Right (RR)" RR "resize-pane -R 5" \
    "Select Pane Left (PL)" PL "select-pane -L" \
    "Select Pane Down (PD)" PD "select-pane -D" \
    "Select Pane Up (PU)" PU "select-pane -U" \
    "Select Pane Right (PR)" PR "select-pane -R" \
    "Launch Ranger (LR)" LR "run-shell 'tmux split-window -vb -c \"#{pane_current_path}\" ranger'"

# Load themes
set -g @plugin "nordtheme/tmux"
# set -g @plugin 'erikw/tmux-powerline'

# Set Telescope Pickers: use telescope-tmux for picking sessions and windows 
bind s display-popup -E -w 80% -h 80% nvim -c ":Telescope tmux sessions quit_on_select=true"
bind w display-popup -E -w 80% -h 80% nvim -c ":Telescope tmux windows quit_on_select=true"

# Load Tmux Plugin Manager (TPM)
# Initialize TPM (ensure this is at the end of tmux.conf)
if "test ! -d ~/.tmux/plugins/tpm" \
"run 'git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm && ~/.tmux/plugins/tpm/bin/install_plugins'"

run '~/.tmux/plugins/tpm/tpm'

#-#-# start_of_ranger_tmux_config #-#-#
bind-key Bspace run-shell -b '/Users/joshpeterson/.pyenv/versions/3.11.4/bin/python3.11 -m ranger_tmux.drop'
#-#-# end_of_ranger_tmux_config #-#-#
